

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Implementation notes I: The math and physics behind meep.adjoint &mdash; meep.adjoint 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Overview of the meep.adjoint class hierarchy" href="ClassHierarchy.html" />
    <link rel="prev" title="Configuring and customizing meep.adjoint" href="../Config/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> meep.adjoint
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">meep.adjoint Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">meep.adjoint: Adjoint-solver module for pymeep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Examples/index.html">Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Visualization/index.html">Visualization Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Config/index.html">Configuration and customization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Implementation I: Physics and math</a></li>
<li class="toctree-l1"><a class="reference internal" href="ClassHierarchy.html">Implementation II: Class hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/index.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">meep.adjoint</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Implementation notes I: The math and physics behind <code class="xref py py-mod docutils literal notranslate"><span class="pre">meep.adjoint</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Implementation/MathAndPhysicsOfAdjoints.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="implementation-notes-i-the-math-and-physics-behind-meep-adjoint">
<h1>Implementation notes I: The math and physics behind <code class="xref py py-mod docutils literal notranslate"><span class="pre">meep.adjoint</span></code><a class="headerlink" href="#implementation-notes-i-the-math-and-physics-behind-meep-adjoint" title="Permalink to this headline">¶</a></h1>
<p>These notes are intended as something of a companion to the
[user’s manual and tutorial documentation for adjoint-based
optimization in &lt;span class=”SC”&gt;meep&lt;/span&gt;](Overview.md);
whereas the goal of those pages is to document the user interface
and explain how to <em>use</em> the solver for practical problems,
our focus here will be what’s going on beneath the hood—how
the solver actually <em>works.</em></p>
<p>Actually, as will be clear to anyone who has ever reviewed the
fundamentals of
[adjoint sensitivity analysis](<a class="reference external" href="https://en.wikipedia.org/wiki/Adjoint_state_method">https://en.wikipedia.org/wiki/Adjoint_state_method</a>),
the theoretical basis of the method and the derivation of its key
formulas are almost trivially straightforward, with the only
potential source of difficulty being how to massage the mechanics
of the procedure into a &lt;span class=”SC”&gt;meep&lt;/span&gt;-friendly form.</p>
<p>## Toy problem</p>
<p>Ultimately we will want to use adjoint methods to differentiate
complex objective functions—involving quantities such as
Poynting fluxes and mode-expansion coefficients—with respect
to various different types of parameters describing material geometries.
However, before tackling the problem in that full generality,
it’s useful to build up to it by starting with a simple toy problem
and adding complications one at a time. Thus we consider a
simple waveguide geometry, excited by a point source at
$vb{x}sup{src}$, and define our objective function to be
simply the frequency-domain electric-field amplitude at
a point $vb{x}sup{obj}$; we will compute the derivative
of this objective function with respect to the permittivity
$epsilonsup{des}$
in a small “design region” $mc{V}sup{des}$
centered at a third point $vb{x}sup{des}$.</p>
<p>![AdjointToyGeometry1](images/AdjointToyGeometry1.png)</p>
<p>### Permittivity derivative by finite-differencing</p>
<p>An obvious brute-force way to get at this is simply
to do two &lt;span class=SC&gt;meep&lt;/span&gt; calculations, with $epsilonsup{des}$
augmented by a small finite amount $Deltaepsilon$ on the
second run, then compute the difference between the frequency-domain
electric fields at $vb{x}sup{obj}$ and divide
by $Deltaepsilon$ to estimate the derivative.
Here are plots of the unperturbed field and the field perturbation
(difference between perturbed and unperturbed field):</p>
<ul class="simple">
<li><p>$wt{E_{z0}}(omega_0, vb{x})$ (unperturbed):</p></li>
</ul>
<p>![Unperturbed field](images/AdjointToyEz0.png)</p>
<ul class="simple">
<li><p>$Delta {wt E_z}(omega_0, vb{x})$ (perturbed-unperturbed):</p></li>
</ul>
<p>![Perturbation field](images/AdjointToydEz_FD.png)</p>
<p>(Here and below we use the tilde sign ($sim$) to indicate frequency-domain
fields and sources.)</p>
<p>### Permittivity derivative from effective sources</p>
<p>One way to think about the effect of a localized permittivity
bump goes like this: Increasing the permittivity in some localized
region of a material body corresponds to increasing the
polarizability in that region—that is, the ease with which
positive and negative charges in the material, ordinarily bound
so tightly together that they neutralize each other as sources,
can be induced by applied electric fields to separate (“polarize”),
whereupon they cease to cancel each other and act as effective
sources contributing to electromagnetic fields.
Of course, if there were no electric field in the material,
then we could increase its polarizability as much as we pleased
without producing any sources—zero times a bigger
coefficient being still zero—but here there <em>is</em> a nonzero
electric field throughout our geometry, due to the point source
in the unperturbed problem, which means that the effect of bumping the
permittivity of the design region may be approximated by
adding new <em>sources</em> in that region, with strength
proportional to $Deltaepsilon$ and to the unperturbed electric field.
More specifically, in a frequency-domain problem involving time-harmonic
fields and sources with angular frequency $omega$ (time dependence
$propto e^{-iomega t}$), the following perturbations are
equivalent:
$$
begin{array}{ccc}</p>
<blockquote>
<div><p>left(begin{array}{c}
text{a permittivity shift of } Deltaepsilon \
text{over a small region } mc{V} text{ in which} \
text{the electric field is } wt{vb{E}}
end{array}right)
&amp;Longleftrightarrow &amp;</p>
<blockquote>
<div><dl class="simple">
<dt>left(begin{array}{c}</dt><dd><p>text{a localized electric current } \
text{flowing in }mc{V} text{ with amplitude } \
Deltawt{vb J}=-iomegaDeltaepsilon wt{vb{E}}</p>
</dd>
</dl>
<p>end{array}right)</p>
</div></blockquote>
</div></blockquote>
<p>end{array}
$$</p>
<p>![AdjointToyGeometry1](images/AdjointToyGeometry2.png)</p>
<p>Superposing this effective source with the original point source
at $vb{x}sup{src}$ yields a source configuration that,
acting on the <em>unperturbed</em> geometry, produces the same fields
as the point source alone acting on the <em>perturbed</em> geometry.</p>
<p>Alternatively, by exploiting the linearity of Maxwell’s equations
(and assuming we have linear media!) we could just as easily
remove the original point source and compute the fields of
$wt{Delta vb{J}}$ <em>alone</em>, which, upon dividing through by
$Deltaepsilon$, give just the derivatives of field components
with respect to $epsilon$. In other words,
$$ pard{ wt{vb E} (vb xsup{obj}) }{epsilonsup{des}}</p>
<blockquote>
<div><p>equiv
left(begin{array}{cc}
text{electric field at }vb{x}sup{obj} text{ due to }\
text{current at }vb{x}sup{des}text{ with amplitude}\
wt{Delta vb J}=-iomegawt{vb{E}}(vb{x}sup{obj})
end{array}right)
tag{1a}</p>
</div></blockquote>
<p>$$
Analogous reasoning yields a prescription for magnetic-field derivatives:
$$ pard{wt{vb{H}}(vb xsup{obj})}{epsilonsup{des}}</p>
<blockquote>
<div><p>equiv
left(
begin{array}{cc}
text{magnetic field at }vb{x}sup{obj} text{ due to }\
text{current at }vb{x}sup{des}text{ with amplitude}\
wt{Delta vb J}=-iomegawt{vb{E}}(vb{x}sup{obj})
end{array}
right)
tag{1b}</p>
</div></blockquote>
<p>$$</p>
<p>### Digression: Configuring time-domain sources for desired frequency-domain fields in &lt;span class=SC&gt;meep&lt;/span&gt;</p>
<p>In frequency-domain electromagnetism we usually consider
a time-harmonic source distribution of the form
$$</p>
<blockquote>
<div><p>vb{J}sup{monochromatic}(t,vb{x})equiv
wt{vb{J}}(vb x)e^{-iomega t}</p>
</div></blockquote>
<p>$$
and we ask for the time-harmonic electric field distribution
radiated by this distribution:
$$</p>
<blockquote>
<div><p>vb{E}sup{monochromatic}(t,vb{x})equiv
wt{vb{E}}(vb x)e^{-iomega t}</p>
</div></blockquote>
<p>$$
where $sim$ indicates frequency-domain amplitudes.
A typical frequency-domain solver might input
$wt{vb J}(vb x)$ and output
$wt{vb E}(vb x)$:
$$ wt{vb J}(vb x)</p>
<blockquote>
<div><p>quad Longrightarrow quad
begin{array}{<a href="#id3"><span class="problematic" id="id4">|c|</span></a>}hline\
text{    frequency-domain solver    }\
\hlineend{array}
quad Longrightarrow quad
wt{vb E}(vb x)</p>
</div></blockquote>
<p>$$</p>
<p>On the other hand, when using &lt;span class=SC&gt;meep&lt;/span&gt; to compute
the fields produced by a given spatial source distribution,
we typically construct a time-domain source of the form
$$vb{J}sup{meep}(t,vb{x})=G(t)wt{vb{J}}(vb x)$$
where $G(t)$ is a Gaussian temporal envelope.
More specifically, for &lt;span class=SC&gt;meep&lt;/span&gt;’s <cite>GaussianSrc</cite> with
center frequency $omega_0=2pi f_0$,
frequency width $Delta omega =2pi Delta f$, and
peak time $t_0$, we have
$$ G(t) = e^{-iomega_0(t-t_0) - frac{1}{2}[Delta f(t-t_0)]^2}.$$
The Fourier transform of this is
$$</p>
<blockquote>
<div><p>wt G(omega) equiv frac{1}{sqrt{2pi}}
int e^{iomega t}G(t),dt =
frac{1}{Delta f}
e^{iomega t_0 -frac{(omega-omega_0)^2}{2Delta f^2}}.</p>
</div></blockquote>
<p>$$
The &lt;span class=SC&gt;meep&lt;/span&gt; version of the above
input/output diagram looks like
$$ G(t)wt{vb J}(vb x)</p>
<blockquote>
<div><p>quad Longrightarrow quad
begin{array}{<a href="#id5"><span class="problematic" id="id6">|c|</span></a>}hline\
text{ MEEP }\
text{    (timestepping + DFT)    } \
\hlineend{array}
quad Longrightarrow quad
wt{G}(omega)wt{vb E}(vb x)</p>
</div></blockquote>
<p>$$</p>
<p>The upshot is that the frequency-domain fields obtained from a
&lt;span class=SC&gt;meep&lt;/span&gt; run with a Gaussian source
come out multiplied by a factor of $wt{G}(omega)$ that should
be divided out to yield the desired frequency-domain quantities.</p>
<p>## Invoking reciprocity</p>
<p>It is convenient to describe the process described above
in the language of frequency-domain Green’s functions, which
express the fields radiated by monochromatic source distributions
as spatial convolutions:
$$ wt{E_i}(omega, vb{x}sup{dest}) =</p>
<blockquote>
<div><blockquote>
<div><p>int
mc{G}sup{EE}_{ij}(omega, vb{x}sup{dest}, vb{x}sup{src})
wt{J_j}(omega, vb{x}sup{src})</p>
</div></blockquote>
<p>,dvb{x}sup{src}</p>
</div></blockquote>
<p>$$
with $bmc{G}sup{EE}$ the
electric-electric dyadic Green’s function of the material geometry
(giving the electric field produced by a unit-strength electric
current).
In this language, the effective-source representation
of the permittivity derivative reads
$$ pard{wt{E}_i(vb{x}sup{obj})}{epsilonsup{des}}</p>
<blockquote>
<div><p>=
int mc{G}sup{EE}_{ij}(vb{x}sup{obj}, vb{x}sup{des})
left[-iomega wt{E}_j(vb{x}sup{des})right]
,dvb{x}sup{des}</p>
</div></blockquote>
<p>$$
It is convenient to think of the RHS here as a double convolution
of two vector-valued functions with the $bmc{G}sup{EE}$ kernel:
$$ pard{wt{E}_i(vb{x}sup{obj})}{epsilonsup{des}}</p>
<blockquote>
<div><dl class="simple">
<dt>=</dt><dd><dl class="simple">
<dt>left[ vphantom{wt{vb E}sup{des}}</dt><dd><p>,, boldsymbol{delta}_isup{obj},,</p>
</dd>
</dl>
</dd>
</dl>
<p>right]
star bmc{G}sup{EE} star
left[-iomega wt{vb E}sup{des}right]</p>
</div></blockquote>
<p>$$
or
$$ pard{wt E_i(vb{x}sup{obj})}{epsilonsup{des}}</p>
<blockquote>
<div><dl class="simple">
<dt>=-iomegaVMV{ boldsymbol{delta}_isup{obj} }</dt><dd><p>{ bmc Gsup{EE}                 }
{ wt{vb E}sup{des}            }</p>
</dd>
</dl>
</div></blockquote>
<p>$$
where $star$ denotes convolution,
$boldsymbol{delta}_isup{obj}$ is short for
$delta_{ij} delta(vb{x}-vb{x}sup{obj}),$
and the bra-ket notation describes a machine that inputs two
vector-valued functions $vb{f},vb{g}$ and a kernel $mc{K}$
and outputs a scalar quantity:
$$ VMV{vb f}{bmc K}{vb g}</p>
<blockquote>
<div><dl class="simple">
<dt>equiv sum_{ij} iint f_i(vb{x})</dt><dd><p>mc{K}_{ij}(vb{x},vb{x}^prime)
g_j(vb{x}^prime)
,dvb{x} ,dvb{x}^prime</p>
</dd>
</dl>
</div></blockquote>
<p>$$
(Note that this is not a Hermitian inner product, i.e. the first
factor is not conjugated.)</p>
<p>For the magnetic-field derivative we have similarly
$$ pard{wt{H}_i(vb{x}sup{obj})}{epsilonsup{des}}</p>
<blockquote>
<div><dl class="simple">
<dt>=-iomegaVMV{ boldsymbol{delta}_isup{obj} }</dt><dd><p>{ boldsymbol{mc G}sup{ME}   }
{ wt{vb E}sup{des}          }</p>
</dd>
</dl>
</div></blockquote>
<p>$$
where $bmc{G}sup{ME}$ is the magnetic-electric
Green’s function, giving the magnetic field produced
by an electric current.</p>
<p>Computationally, inner products like
$VMV{vb f}{bmc Gsup{EE}}{vb g}$
for arbitrary functions $vb{f}(vb x), vb{g}(vb x)$
may be evaluated in &lt;span class=SC&gt;meep&lt;/span&gt;
as follows:</p>
<ol class="arabic">
<li><p>Create an electric current source with
spatially-varying amplitude $vb{g}(vb x)$
and Gaussian temporal envelope $G(t)$.</p></li>
<li><p>Timestep and DFT to compute the frequency-domain electric field
$wt{vb E}(omega; vb{x})$ produced by this source.</p></li>
<li><p>Compute the inner product
$[wt{G}(omega)]^{-1}</p>
<blockquote>
<div><p>int vb{f}cdot wt{vb E},dV.$</p>
</div></blockquote>
<p>(The normalization prefactor was discussed above.)</p>
</li>
</ol>
<p>The virtue of writing things this way is that it allows the physical
property of reciprocity to be expressed as the mathematical property
that the aforementioned inner-product machine is insensitive to the
order of its arguments, i.e. we can flip the $vb f$ and $vb g$
inputs and still get the same scalar output:
$$ VMV{vb f}{bmc K}{vb g} = VMV{vb g}{bmc K}{vb f}</p>
<blockquote>
<div><p>quadtext{ for }quad bmc K= bmc{G}sup{EE}, bmc{G}sup{ME}.</p>
</div></blockquote>
<p>$$</p>
<p>Applying reciprocity to the above expressions for field derivatives yields
begin{align*}
pard{wt E_i(vb{x}sup{obj})}{epsilonsup{des}}</p>
<blockquote>
<div><dl class="simple">
<dt>&amp;=-iomegaVMV{ wt{vb E }sup{des}         }</dt><dd><p>{ bmc{G}sup{EE}              }
{ boldsymbol{delta}_isup{obj} }</p>
</dd>
</dl>
<p>tag{2}</p>
</div></blockquote>
<p>\[5pt]
pard{wt H_i(vb{x}sup{obj})}{epsilonsup{des}}</p>
<blockquote>
<div><dl class="simple">
<dt>&amp;=-iomegaVMV{ wt{vb E }sup{des}         }</dt><dd><p>{ bmc{G}sup{ME}              }
{ boldsymbol{delta}_isup{obj} }</p>
</dd>
</dl>
<p>tag{3a}</p>
</div></blockquote>
<dl>
<dt>\</dt><dd><dl class="simple">
<dt>hphantom{pard{wt H_i(vb{x}sup{obj})}{epsilonsup{des}}}</dt><dd><dl class="simple">
<dt>&amp;=+iomegaVMV{ wt{vb E}sup{des}          }</dt><dd><p>{ bmc{G}sup{EM}              }
{ boldsymbol{delta}_isup{obj} }</p>
</dd>
</dl>
</dd>
</dl>
<p>tag{3b}</p>
</dd>
</dl>
<p>end{align*}
where in going to the last line we invoked the identity
$bmc{G}sup{EM}=-bmc{G}sup{ME}.$</p>
<p>Note that equations (3a) and (3b), notwithstanding their nearly
identical appearance, describe two rather different
&lt;span class=SC&gt;meep&lt;/span&gt; calculations: In the former case
we place an electric source at $vb xsup{obj}$ and timestep to
compute the resulting magnetic field, while in the latter
case we place a magnetic source and timestep
to compute the resulting electric field. (In both cases,
upon computing the field in question we proceed to compute its
overlap with the unperturbed $vb E$ field in the design region.)</p>
<p>## Differentiating more complicated functions of field components</p>
<p>Thus far we have only considered derivatives of individual
field components, and then only at a single point $vb{x}sup{obj}$;
more generally, we will want to differentiate functions of
multiple field components over a subregion of the grid,
which we will call the <em>objective region</em> $mc{V}sup{obj}$.</p>
<p>### <strong>E</strong>-field energy in region</p>
<p>As one example, the electric field energy in the objective
region is defined by an integral over that region, which &lt;span class=SC&gt;meep&lt;/span&gt;
approximate by a weighted sum over grid points:
$$ mc{E}=</p>
<blockquote>
<div><p>frac{1}{2}int_{mc{V}sup{obj}} epsilon <a href="#id1"><span class="problematic" id="id2">|</span></a>wt{vb E}|^2 ,dmc{V}
approx
frac{1}{2}sum_{i,vb{n}inmc{V}sup{obj}} w_{vb{n}}
epsilon_vb {n} wt E_{ivb n}^* wt E_{ivb n}</p>
</div></blockquote>
<p>$$
Here the sum is over all field components $i={x,y,z}$ and
all grid points $vb{n}$ lying in $mc{V}sup{obj}$,
and $w_{vb{n}}$ is a cubature weight associated with point $vb{n}$
(as returned by [<cite>get_dft_array_metadata</cite>](/Python_User_Interface#metadata)).
Differentiating, we have
begin{align*}</p>
<blockquote>
<div><p>pard{mc E}{epsilonsup{des}}
&amp;=text{Re }sum_{ivb{n}inmc Vsup{obj}} w_{vb n}epsilon_{vb n}</p>
<blockquote>
<div><p>wt{E}^*_{ivb n} pard{wt{E}_{ivb n}} {epsilonsup{des}}</p>
</div></blockquote>
</div></blockquote>
<p>\
&amp;hspace{-1.5in}text{Insert equation (1a):}
\</p>
<blockquote>
<div><dl>
<dt>&amp;=text{Re }left{ -iomega VMV{epsilon wt{vb E}sup{obj*}}</dt><dd><blockquote>
<div><p>{{bmc G}sup{EE}}
{wt{vb E}sup{des}}</p>
</div></blockquote>
<p>right}</p>
</dd>
</dl>
</div></blockquote>
<p>\
&amp;hspace{-1.5in}text{Invoke reciprocity:}
\</p>
<blockquote>
<div><dl>
<dt>&amp;=text{Re }left{ -iomega VMV{wt{vb E}sup{des}}</dt><dd><blockquote>
<div><p>{{bmc G}sup{EE}}
{epsilon wt{vb E}sup{obj*}}</p>
</div></blockquote>
<p>right}</p>
</dd>
</dl>
</div></blockquote>
<p>end{align*}</p>
<p>### Poynting flux</p>
<p>A case that arises frequently is that in which the objective region
is a cross-sectional surface $mc Ssup{obj}$ cutting normally through a
waveguide or similar structure and the objective function is the
normal Poynting flux through $mc S$.
For example, the $x$-directed Poynting flux is given by
$$</p>
<blockquote>
<div><p>S_x</p>
</div></blockquote>
<p>=
frac{1}{2}text{Re }left{ int_{mc Ssup{obj}} Big(E^*_y H_z + cdotsBig) , dmathbf{x} right}
approx frac{1}{2}text{Re }sum_{vb nin mc Ssup{obj}} w_{vb n}</p>
<blockquote>
<div><p>Big(E^*_{yvb n} H_{zvb n} + cdotsBig)</p>
</div></blockquote>
<p>$$
where $cdots$ refers to three other terms of the form $pm E^*_i H_j$.
Differentiating and rearranging slightly, we have
begin{align*}</p>
<blockquote>
<div><p>pard{S_x}{epsilonsup{des}}
&amp;=text{Re }sum_{vb nin mc Ssup{obj}} w</p>
<blockquote>
<div><dl>
<dt>left{ wt{E}^*_{y} pard{wt{H}_z}{epsilonsup{des}}</dt><dd><blockquote>
<div><p>+wt{H}^*_{z} pard{wt{E}_y}{epsilonsup{des}}</p>
</div></blockquote>
<p>+cdots</p>
</dd>
</dl>
<p>right}</p>
</div></blockquote>
</div></blockquote>
<p>\[5pt]
&amp;hspace{-0.5in}text{Use (1a) and (1b):}
\[5pt]</p>
<blockquote>
<div><dl>
<dt>&amp;=text{Re }left{ -iomega VMV{wt{vb E}_{y}sup{obj*}}</dt><dd><blockquote>
<div><blockquote>
<div><p>{bmc Gsup{ME}}
{wt{vb E}sup{des}}</p>
</div></blockquote>
<dl class="simple">
<dt>-iomega VMV{wt{vb H}_zsup{obj*}}</dt><dd><p>{bmc Gsup{EE}}
{wt{vb E}sup{des}}</p>
</dd>
</dl>
<p>+cdots</p>
</div></blockquote>
<p>right}</p>
</dd>
</dl>
</div></blockquote>
<p>\[5pt]
&amp;hspace{-0.5in}text{Use reciprocity:}
\[5pt]
&amp;=text{Re }left{ -iomega  VMV{wt{vb E}sup{des}}</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><p>{bmc Gsup{ME}}
{wt{vb E}_ysup{obj*}}</p>
</div></blockquote>
<dl class="simple">
<dt>-iomega VMV{wt{vb E}sup{des}}</dt><dd><p>{bmc Gsup{EE}}
{wt{vb H}_zsup{obj*}}</p>
</dd>
</dl>
<p>+cdots</p>
</div></blockquote>
<p>right}</p>
</div></blockquote>
<p>end{align*}</p>
<p>### Mode coefficient</p>
<p>$$ alpha_m^pm = C_1 pm C_2 $$
begin{align*}</p>
<blockquote>
<div><dl class="simple">
<dt>C_1 &amp;=frac{1}{mathcal{N}}</dt><dd><p>int_{mc Ssup{obj}} Big(e^*_y H_z - e^*_z H_yBig)dmathbf{x}\</p>
</dd>
<dt>C_2 &amp;=</dt><dd><p>frac{1}{mathcal{N}}int_{mc Ssup{obj}} Big(h^*_z E_y - h^*_y E_zBig)dmathbf{x}\</p>
</dd>
</dl>
</div></blockquote>
<p>end{align*}</p>
<p>–8&lt;– “doc/docs/AdjointSolver/AdjointLinks.md”</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ClassHierarchy.html" class="btn btn-neutral float-right" title="Overview of the meep.adjoint class hierarchy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../Config/index.html" class="btn btn-neutral float-left" title="Configuring and customizing meep.adjoint" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, MEEP project

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>